# Разклоняващи функции[^diverging]

Разклоняващите функции никога не връщат. Техният тип за връщане се
отбелязва с `!`, което означава празен тип.

```rust
fn foo() -> ! {
    panic!("Това извикване няма да върне управлението.");
}
```
Обратно на всички други типове, от този тип не може да бъде създаден обект,
защото множеството от всичките му възможни стойности е празно. Забележете, че
той е различен от типа `()`, който има точно една празна стойност.[^never_type]

Ето например следната функция връща както обикновено, макар да няма никакви
данни във върнатата стойност.

```rust
fn some_fn() {
    ()
}

fn main() {
    let _a: () = some_fn();
    println!("Функцията 'some_fn()' връща и затова виждате този ред.");
}
```

А тази няма никога да върне управлението обратно към извикващата.

```rust,ignore
#![feature(never_type)]

fn main() {
    let x: ! = panic!("Това извикване никога не връща.");
    println!("Никога няма да видите този ред!");
}
```

Макар това свойство да изглежда като отвлечено понятие, в действителност е
много полезно и често удобно. Главното предимство на този тип е, че може да
бъде приведен към всеки друг и така да бъде ползван на места, където е нужен
точно определен тип, например в разклонения на `match`. Това ни позволява да
пишем код като следния:

```rust
fn main() {
    fn sum_odd_numbers(up_to: u32) -> u32 {
        let mut acc = 0;
        for i in 0..up_to {
            // Забележете, че типът за връщане на този израз за сравнение
            // трябва да бъде u32 заради типа на променливата "addition".
            let addition: u32 = match i%2 == 1 {
                // Променливата "i" е от тип u32, което си е съвсем наред.
                true => i,
                // От друга страна, изразът "continue" не връща u32, но отново е
                // наред, защото той никога не връща и затова не нарушава
                // изискванията за типа на израза за сравнение `match`.
                false => continue,
            };
            acc += addition;
        }
        acc
    }
    println!("Сбор на нечетните числа до 9 (не включено): {}", sum_odd_numbers(9));
}
```
Това е също връщаният тип на функциите, които въртят безкрайно (напр. `loop {}`),
като мрежовите сървъри, или функциите, които прекъсват текущия процес, например
`exit()`.

## Б.пр.

[^diverging]: разклоняващи функции – diverging, защото разклоняват програмния поток, а и
 често се използват в изрази за сравнение `match`, които се разклоняват именно
 благодарение на типа „Никога”.

[^never_type]: никога, типът, наречен Никога – the "Never" type. В книгата
  „Езикът за програмиране Ръст” този тип е наречен „типът Никога”, тъй като,
  когато се използва като тип за връщане от функция, тя никога не връща
  контрола на програмата към обкръжаващия я програмен код.  Вижте [„The Never
  Type that Never Returns”][never_type].

[never_type]: https://doc.rust-lang.org/stable/book/ch19-04-advanced-types.html?highlight=Never#the-never-type-that-never-returns



