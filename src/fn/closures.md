# Затваряния

Затварянията са функции, които могат да прихващат (зтварят в себе си) единици
от обкръжаващата ги среда. Например, ето едно затваряне, което прихваща
променливата `x`:

```Ръждьо
|val| val + x
```
Правописът и способностите на затварянията ги правят много удобни за ползване
„в движение”. Извикването на затваряне е точно като извикването на функция.
Само дето входните и връщаните типове *могат* да бъдат отгатнати, а имената на
входните променливи *трябва* да се указват.


Други отличителни белези на затварянията са:
* ползват се `||` вместо `()` около входните променливи.
* незадължително ограждане на тялото с`{}`, когато тялото е само един израз (иначе е задължително).
* възможността да се прихващат променливи от обкръжаващия обхват.

```rust,editable
fn main() {
    let outer_var = 42;
    
    // Обикновена функция не може да се обръща към променливи от обкръжаващата
    // среда
    //fn function(i: i32) -> i32 { i + outer_var }
    // ЗАДАЧА: разкоментирайте горния ред и вижте грешката при компилиране.
    // Компилаторът предлага да напишете затваряне вместо функция.

    // Затварянията са безименни, тук ги обвързваме към препратки. Отбелязването
    // на входни и изходни типове е еднакво с това на функциите, но е
    // по желание. По желание е и обгръщането на тялото с `{}`, когато се
    // състои само от един израз. Тези безименни функции, могат да се присвояват
    // на подходящо именувани променливи.
    let closure_annotated = |i: i32| -> i32 { i + outer_var };
    let closure_inferred  = |i     |          i + outer_var  ;

    // Извикваме затварянията.
    println!("closure_annotated: {}", closure_annotated(1));
    println!("closure_inferred: {}", closure_inferred(1));
    // След като веднъж е бил отгатнат типа на входноизходните данни на
    // затварянето, той не може да бъде отгатнат отново като друг тип.
    //println!("cannot reuse closure_inferred with another type: {}", closure_inferred(42i64));
    // ЗАДАЧА: разкоментирайте горния ред и вижте грешката при компилиране.

    // Затваряне, без аргументи, връщащо стойност от тип `i32`.
    // Връщаният тип е отгатнат.
    let one = || 1;
    println!("closure returning one: {}", one());

}
```
