# Опасни действия 

Да започнем този раздел със заемка от [представителната документация][unsafe],
„…добре е да избягваме _опасен код_[^unsafe_code].”. Като имаме това предвид,
можем да започнем. Отбелязването на опасност в Ръждьо се ползва за заобикаляне
на мерките за безопасност, наложени  от компилатора. Има четири основни неща, за
които се ползват „опасни блокове”:

* Пряк достъп до сурови указатели;
* извикване на функции, които са опасни (`unsafe`) (включително извикване на
  функция чрез ВЧФ, вижте [съответната глава](std_misc/ffi.md) от книгата); 
* достъп до или промяна на статични меними променливи;
* осъществяване на опасни отличители.

### Сурови указатели
Суровите указатели `*` и препратките `&T` работят по подобен начин, но
препратките са винаги безопасни, понеже винаги сочат към действителни данни,
благодарение на проверителя за заемки. Прекият достъп до суров указател може да
се направи само чрез _опасен_ блок.

```rust,editable
fn main() {
    let raw_p: *const u32 = &10;

    unsafe {
        assert!(*raw_p == 10);
    }
}
```

### Извикване на опасни функции

Някои функции може да бъдат декларирани като `unsafe`. Това означава, че
програмистът поема отговорност за безопасността вместо компилатора. Един
пример за такъв код е [`std::slice::from_raw_parts`], който ще създаде отрязък
от подаден първи член и дължина.

```rust,editable
use std::slice;

fn main() {
    let some_vector = vec![1, 2, 3, 4];

    let pointer = some_vector.as_ptr();
    let length = some_vector.len();

    unsafe {
        let my_slice: &[u32] = slice::from_raw_parts(pointer, length);

        assert_eq!(some_vector.as_slice(), my_slice);
    }
}
```

При използване на `slice::from_raw_parts`, едно от предположенията, които
*трябва* да са потвърдени е, че подаденият улазател сочи към действително място
от паметта и второто, че това място съдържа правилния тип данни. Ако тези
задължителни условия не са спазени, поведението на програмата е
неопределено[^undefined] и не се знае какво ще се случи.

## Б. пр.

[^unsafe_code]: опасен код – unsafe code

[^undefined]: неопределено (поведение) – undefined behaviour

[unsafe]: https://doc.rust-lang.org/book/ch19-01-unsafe-rust.html
[`std::slice::from_raw_parts`]: https://doc.rust-lang.org/std/slice/fn.from_raw_parts.html
